<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sales Bonus Tool</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.0.1/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  :root {
    --bg: #fff; --fg: #000; --bg2: #4CAF50; --bg3: #2196F3;
  }
  [data-theme="dark"] {
    --bg: #333; --fg: #eee; --bg2: #0b7a3c; --bg3: #0e5599;
  }
  body {
    margin:0; font-family:Arial,sans-serif;
    background: var(--bg2);
    color: var(--fg);
    display:flex;justify-content:center;
    padding:2em 0;
  }
  .container {
    background: var(--bg); padding:2em; border-radius:12px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.2);
    width:650px; position:relative;
  }
  .toggle-group { position:absolute; top:1em; left:1em; display:flex; gap:8px; }
  .toggle-group button { padding:0.4em;background:transparent;border:1px solid var(--fg);color:var(--fg);border-radius:4px; cursor:pointer;}
  .header { text-align:center; margin-bottom:1em;
    background: linear-gradient(135deg, var(--bg2), var(--bg3));
    color: var(--fg); font-size:1.3em; font-weight:bold;
    padding:0.8em;border-radius:8px;
  }
  .sales-list, .preview-list { list-style:none; padding:0; margin:0.5em 0;}
  .sales-list li, .preview-list li { display:flex; justify-content:space-between; align-items:center; margin:0.4em 0;}
  input, select { padding:0.4em; border:1px solid #ccc; border-radius:4px;}
  canvas { max-width:100%; margin-top:1em; background:var(--bg); border-radius:8px;}
  .buttons { display:flex; justify-content:space-between; margin:1em 0;}
  button, .icon-btn { padding:0.6em; font-size:1em; border:none; border-radius:6px;
    cursor:pointer; color:#fff; flex:1; margin:0 0.3em; transition:opacity .2s;}
  button:hover, .icon-btn:hover { opacity:0.9; }
  #resetBtn { background:#f44336; } #calculateBtn { background:var(--bg2); }
  #downloadBtn, #downloadCustom { background:var(--bg3); }
  #noteBtn { background:#FF9800; position:absolute; top:1.2em; right:1.2em; width:40px; height:40px;}
  .note-area, .custom-form { display:none; margin-top:1em;}
  .note-area textarea { width:100%; height:180px; font-family:monospace; padding:.6em;}
  .custom-form-row { display:flex; flex-wrap:wrap; gap:8px;}
  .preview-list li { background:#f9f9f9; padding:.6em; border-radius:4px; justify-content:space-between;}
  .preview-list button { background:#e91e63; border:none; padding:.4em .6em; border-radius:4px; cursor:pointer; color:#fff;}
</style>
</head>
<body>
<div class="container" id="tracker" data-theme="light">
  <div class="toggle-group">
    <button id="langToggle">FR</button>
    <button id="themeToggle"></button>
  </div>
  <button class="icon-btn" id="noteBtn"></button>
  <div class="header">Sales Bonus Tracker</div>

  <ul class="sales-list" id="salesCountList"></ul>
  <div class="total-section">Total Bonus: <span id="total">0</span> MAD</div>
  <div class="buttons">
    <button id="calculateBtn">Calculate</button>
    <button id="resetBtn">Reset</button>
  </div>
  <div class="buttons">
    <button id="downloadBtn">Download PDF</button>
    <button id="toggleCustom">Custom Tracker</button>
  </div>

  <div class="note-area">
    <textarea id="noteText">Dealer Code/Sales Rep ID: 1100054081/ [Your REP ID]
Campaign Name: [Found in Alvaria]
...</textarea>
    <button id="copyNote">Copy to Clipboard</button>
  </div>

  <div class="custom-form" id="customForm">
    <div class="custom-form-row">
      <select id="saleType"><option disabled selected>Type of Sale</option></select>
      <input type="text" id="cName" placeholder="Name">
      <input type="text" id="cBAN" placeholder="BAN">
      <input type="text" id="cCID" placeholder="CID">
      <input type="text" id="cNumber" placeholder="Number">
      <input type="text" id="cOffer" placeholder="Offer Details">
      <input type="text" id="cOrder" placeholder="Order Number">
      <input type="date" id="cDate">
    </div>
    <div class="buttons">
      <button id="addCustom">Add Entry</button>
      <button id="downloadCustom" style="display:none">Download Tracker</button>
    </div>
    <ul class="preview-list" id="previewList"></ul>
  </div>

  <div style="margin-top:2em;">
    <h3 style="display:flex;align-items:center;gap:.5em;"><span style="font-size:1.3em;"></span><span id="grpTitle">Your Group</span></h3>
    <p id="grpPrompt">Enter # of sales this week:</p>
    <input type="number" id="groupSales" min="0" placeholder="e.g. 5">
    <button id="checkGroup">Check Your Group</button>
    <p id="groupResult" style="text-align:center;font-weight:bold;"></p>
    <canvas id="historyChart" height="200"></canvas>
  </div>
</div>

<script>
// Config
const rates = { renewal:30, mobTelus:130, mobKoodo:70, shsA:300, homeView:120, koodoInternet:170, ilecFiber:200, ilecOptikTV:100, vulcanFiber:300, vulcanOptikTV:150, streamPlus:30, wirelessHP:30 };
const labels = { renewal:"Renewal", mobTelus:"MOB Telus", mobKoodo:"MOB Koodo", shsA:"SHS", homeView:"HomeView", koodoInternet:"Koodo Internet", ilecFiber:"ILEC Fiber", ilecOptikTV:"ILEC Optik TV", vulcanFiber:"Vulcan Fiber", vulcanOptikTV:"Vulcan Optik TV", streamPlus:"Stream+", wirelessHP:"Wireless HP" };

// Elements
const themeBtn = document.getElementById('themeToggle');
const langBtn = document.getElementById('langToggle');
const container = document.getElementById('tracker');

// Initialize variables
let entries = [];
let history = load('history') || [];

// Build sales inputs
const countList = document.getElementById('salesCountList');
Object.keys(rates).forEach(k => {
  const li = document.createElement('li');
  li.innerHTML = `<label>${labels[k]}</label><input type="number" id="${k}" min="0" value="0">`;
  countList.appendChild(li);
});

// Populate saleType dropdown
const saleType = document.getElementById('saleType');
Object.values(labels).forEach(l => {
  saleType.innerHTML += `<option>${l}</option>`;
});

// Toggle theme
themeBtn.onclick = () => {
  const current = container.getAttribute('data-theme');
  const next = current === 'light' ? 'dark' : 'light';
  container.setAttribute('data-theme', next);
  themeBtn.textContent = current==='light'?'':'';
  save('theme', next);
};
// Toggle language (English <-> French)
langBtn.onclick = () => {
  const isFr = langBtn.textContent==='EN';
  langBtn.textContent = isFr?'FR':'EN';
  updateLanguage(isFr ? 'fr' : 'en');
  save('lang', isFr?'fr':'en');
};
function updateLanguage(lang) {
  const L = {
    en: { calc:"Calculate", reset:"Reset", download:"Download PDF", custom:"Custom Tracker", checkGrp:"Check Your Group", grpPrompt:"Enter # of sales this week:", grpTitle:"Your Group"},
    fr: { calc:"Calculer", reset:"Réinitialiser", download:"Télécharger PDF", custom:"Traqueur Perso", checkGrp:"Vérifier Votre Groupe", grpPrompt:"Entrez n° de ventes cette semaine:", grpTitle:"Votre Groupe"}
  };
  document.getElementById('calculateBtn').textContent = L[lang].calc;
  document.getElementById('resetBtn').textContent = L[lang].reset;
  document.getElementById('downloadBtn').textContent = L[lang].download;
  document.getElementById('toggleCustom').textContent = L[lang].custom;
  document.getElementById('checkGroup').textContent = L[lang].checkGrp;
  document.getElementById('grpPrompt').textContent = L[lang].grpPrompt;
  document.getElementById('grpTitle').textContent = L[lang].grpTitle;
}

// Load saved theme/lang
const savedTheme = load('theme') || 'light';
container.setAttribute('data-theme', savedTheme);
themeBtn.textContent = savedTheme==='light'?'':'';
const savedLang = load('lang') || 'en';
langBtn.textContent = savedLang==='en'?'FR':'EN';
updateLanguage(savedLang);

// Utility: localStorage
function save(key,val){ localStorage.setItem(key,JSON.stringify(val)); }
function load(key){ return JSON.parse(localStorage.getItem(key)); }

// Sales calculator
document.getElementById('calculateBtn').onclick = () => {
  let total=0;
  Object.keys(rates).forEach(k => {
    const v=+(document.getElementById(k).value)||0;
    total += v*rates[k];
  });
  document.getElementById('total').textContent = total.toLocaleString();
  // Save history (today)
  const today = new Date().toLocaleDateString();
  history = history.filter(e=>e.date!==today);
  history.push({date:today, total});
  save('history', history);
  renderChart();
};

// Reset
document.getElementById('resetBtn').onclick = () => {
  Object.keys(rates).forEach(k=>document.getElementById(k).value=0);
  document.getElementById('total').textContent='0';
};

// Download PDF
document.getElementById('downloadBtn').onclick = () => {
  const {jsPDF}=window.jspdf; const doc=new jsPDF();
  doc.setFontSize(18); doc.text("Sales Bonus Tracker",14,20);
  doc.setFontSize(12); let y=35;
  Object.keys(rates).forEach(k=>{
    const cnt=+(document.getElementById(k).value)||0;
    doc.text(`${labels[k]}: ${cnt} × ${rates[k]} = ${cnt*rates[k]} MAD`,14,y);
    y+=8;
  });
  doc.setFontSize(14); doc.text(`Total Bonus: ${document.getElementById('total').textContent} MAD`,14,y+10);
  doc.save("sales-bonus-tracker.pdf");
};

// Note template
document.getElementById('noteBtn').onclick = () => {
  const na = document.querySelector('.note-area');
  na.style.display = na.style.display==='block' ? 'none':'block';
};
document.getElementById('copyNote').onclick = () => {
  document.getElementById('noteText').select();
  document.execCommand('copy');
  alert('Copied!');
};

// Custom Tracker
document.getElementById('toggleCustom').onclick = () => {
  document.getElementById('customForm').style.display = 'block';
};
document.getElementById('addCustom').onclick = () => {
  const d={};
  ["saleType","cName","cBAN","cCID","cNumber","cOffer","cOrder","cDate"].forEach(id=>{
    d[id]=document.getElementById(id).value;
  });
  entries.push(d); renderPreview(); document.getElementById('downloadCustom').style.display='block';
};
function renderPreview(){
  const prev=document.getElementById('previewList');
  prev.innerHTML='';
  entries.forEach((e,i)=>{
    const li=document.createElement('li');
    li.innerHTML = `${e.saleType||'—'} | ${e.cName||'—'} | ${e.cOrder||'—'} <button onclick="entries.splice(${i},1);renderPreview();if(entries.length===0)document.getElementById('downloadCustom').style.display='none';">Remove</button>`;
    prev.appendChild(li);
  });
}
document.getElementById('downloadCustom').onclick = () => {
  const {jsPDF}=window.jspdf; const doc=new jsPDF();
  doc.setFontSize(18); doc.text("Custom Sales Entries",14,20);
  doc.setFontSize(12); let y=35;
  entries.forEach((e,idx)=>{
    doc.text(`Entry ${idx+1}:`,14,y); y+=6;
    for(let k in e) if(e[k]){ doc.text(`• ${k}: ${e[k]}`,14,y); y+=6;}
    y+=4;
  });
  doc.save("custom-sales-entries.pdf");
};

// Your Group
document.getElementById('checkGroup').onclick = () => {
  const s=+(document.getElementById('groupSales').value)||0;
  let g='H';
  if(s>=3&&s<=6) g='C';
  else if(s>=7&&s<=12) g='B';
  else if(s>=13&&s<=19) g='A';
  else if(s>=20) g='A+';
  document.getElementById('groupResult').textContent = ` You will be in Group ${g} next week!`;
};

// Chart drawing
const ctx = document.getElementById('historyChart');
const chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: history.map(h=>h.date),
    datasets: [{ label:'Daily Bonus', data: history.map(h=>h.total), borderColor:'#3cba9f', fill:false }]
  },
  options:{ responsive:true }
});
function renderChart(){
  chart.data.labels = history.map(h=>h.date);
  chart.data.datasets[0].data = history.map(h=>h.total);
  chart.update();
}
renderChart();
</script>
</body>
</html>